/*!
 * Copyright 2012, Chris Wanstrath
 * Released under the MIT License
 * https://github.com/defunkt/jquery-pjax
 */
(function(h){function l(F,G,H){var I=this;return this.on("click.pjax",F,function(K){var J=h.extend({},t(G,H));if(!J.container){J.container=h(this).attr("data-pjax")||I}m(K,J)})}function m(K,G,H){H=t(G,H);var J=K.currentTarget;if(J.tagName.toUpperCase()!=="A"){throw"$.fn.pjax or $.pjax.click requires an anchor element"}if(K.which>1||K.metaKey||K.ctrlKey||K.shiftKey||K.altKey){return}if(location.protocol!==J.protocol||location.hostname!==J.hostname){return}if(J.href.indexOf("#")>-1&&y(J)==y(location)){return}if(K.isDefaultPrevented()){return}var L={url:J.href,container:h(J).attr("data-pjax"),target:J};var I=h.extend({},L,H);var F=h.Event("pjax:click");h(J).trigger(F,[I]);if(!F.isDefaultPrevented()){B(I);K.preventDefault();h(J).trigger("pjax:clicked",[I])}}function r(I,F,G){G=t(F,G);var H=I.currentTarget;if(H.tagName.toUpperCase()!=="FORM"){throw"$.pjax.submit requires a form element"}var J={type:H.method.toUpperCase(),url:H.action,container:h(H).attr("data-pjax"),target:H};if(J.type!=="GET"&&window.FormData!==undefined){J.data=new FormData(H);J.processData=false;J.contentType=false}else{if(h(H).find(":file").length){return}J.data=h(H).serializeArray()}B(h.extend({},J,G));I.preventDefault()}function B(F){F=h.extend(true,{},h.ajaxSettings,B.defaults,F);if(h.isFunction(F.url)){F.url=F.url()}var K=F.target;var J=q(F.url).hash;var G=F.context=s(F.container);if(!F.data){F.data={}}if(h.isArray(F.data)){F.data.push({name:"_pjax",value:G.selector})}else{F.data._pjax=G.selector}function I(O,M,N){if(!N){N={}}N.relatedTarget=K;var P=h.Event(O,N);G.trigger(P,M);return !P.isDefaultPrevented()}var H;F.beforeSend=function(N,M){if(M.type!=="GET"){M.timeout=0}N.setRequestHeader("X-PJAX","true");N.setRequestHeader("X-PJAX-Container",G.selector);if(!I("pjax:beforeSend",[N,M])){return false}if(M.timeout>0){H=setTimeout(function(){if(I("pjax:timeout",[N,F])){N.abort("timeout")}},M.timeout);M.timeout=0}F.requestUrl=q(M.url).href};F.complete=function(M,N){if(H){clearTimeout(H)}I("pjax:complete",[M,N,F]);I("pjax:end",[M,F])};F.error=function(P,Q,N){var M=x("",P,F);var O=I("pjax:error",[P,Q,N,F]);if(F.type=="GET"&&Q!=="abort"&&O){z(M.url)}};F.success=function(P,O,V){var R=B.state;var U=(typeof h.pjax.defaults.version==="function")?h.pjax.defaults.version():h.pjax.defaults.version;var W=V.getResponseHeader("X-PJAX-Version");var N=x(P,V,F);if(U&&W&&U!==W){z(N.url);return}if(!N.contents){z(N.url);return}B.state={id:F.id||n(),url:N.url,title:N.title,container:G.selector,fragment:F.fragment,timeout:F.timeout};if(F.push||F.replace){window.history.replaceState(B.state,N.title,N.url)}try{document.activeElement.blur()}catch(T){}if(N.title){document.title=N.title}I("pjax:beforeReplace",[N.contents,F],{state:B.state,previousState:R});G.html(N.contents);var Q=G.find("input[autofocus], textarea[autofocus]").last()[0];if(Q&&document.activeElement!==Q){Q.focus()}a(N.scripts);if(typeof F.scrollTo==="number"){h(window).scrollTop(F.scrollTo)}if(J!==""){var M=q(N.url);M.hash=J;B.state.url=M.href;window.history.replaceState(B.state,N.title,M.href);var S=document.getElementById(M.hash.slice(1));if(S){h(window).scrollTop(h(S).offset().top)}}I("pjax:success",[P,O,V,F])};if(!B.state){B.state={id:n(),url:window.location.href,title:document.title,container:G.selector,fragment:F.fragment,timeout:F.timeout};window.history.replaceState(B.state,document.title)}var L=B.xhr;if(L&&L.readyState<4){L.onreadystatechange=h.noop;L.abort()}B.options=F;var L=B.xhr=h.ajax(F);if(L.readyState>0){if(F.push&&!F.replace){k(B.state.id,G.clone().contents());window.history.pushState(null,"",D(F.requestUrl))}I("pjax:start",[L,F]);I("pjax:send",[L,F])}return B.xhr}function w(F,G){var H={url:window.location.href,push:false,replace:true,scrollTo:false};return B(h.extend(H,t(F,G)))}function z(F){window.history.replaceState(null,"",B.state.url);window.location.replace(F)}var j=true;var E=window.location.href;var C=window.history.state;if(C&&C.container){B.state=C}if("state" in window.history){j=false}function c(G){var L=B.state;var F=G.state;if(F&&F.container){if(j&&E==F.url){return}if(B.state&&B.state.id===F.id){return}var H=h(F.container);if(H.length){var M,J=f[F.id];if(B.state){M=B.state.id<F.id?"forward":"back";u(M,B.state.id,H.clone().contents())}var K=h.Event("pjax:popstate",{state:F,direction:M});H.trigger(K);var N={id:F.id,url:F.url,container:H,push:false,fragment:F.fragment,timeout:F.timeout,scrollTo:false};if(J){H.trigger("pjax:start",[null,N]);B.state=F;if(F.title){document.title=F.title}var I=h.Event("pjax:beforeReplace",{state:F,previousState:L});H.trigger(I,[J,N]);H.html(J);H.trigger("pjax:end",[null,N])}else{B(N)}H[0].offsetHeight}else{z(location.href)}}j=false}function e(G){var F=h.isFunction(G.url)?G.url():G.url,J=G.type?G.type.toUpperCase():"GET";var H=h("<form>",{method:J==="GET"?"GET":"POST",action:F,style:"display:none"});if(J!=="GET"&&J!=="POST"){H.append(h("<input>",{type:"hidden",name:"_method",value:J.toLowerCase()}))}var I=G.data;if(typeof I==="string"){h.each(I.split("&"),function(K,L){var M=L.split("=");H.append(h("<input>",{type:"hidden",name:M[0],value:M[1]}))})}else{if(typeof I==="object"){for(key in I){H.append(h("<input>",{type:"hidden",name:key,value:I[key]}))}}}h(document.body).append(H);H.submit()}function n(){return(new Date).getTime()}function D(F){return F.replace(/\?_pjax=[^&]+&?/,"?").replace(/_pjax=[^&]+&?/,"").replace(/[\?&]$/,"")}function q(G){var F=document.createElement("a");F.href=G;return F}function y(F){return F.href.replace(/#.*/,"")}function t(F,G){if(F&&G){G.container=F}else{if(h.isPlainObject(F)){G=F}else{G={container:F}}}if(G.container){G.container=s(G.container)}return G}function s(F){F=h(F);if(!F.length){throw"no pjax container for "+F.selector}else{if(F.selector!==""&&F.context===document){return F}else{if(F.attr("id")){return h("#"+F.attr("id"))}else{throw"cant get selector for pjax container!"}}}}function o(G,F){return G.filter(F).add(G.find(F))}function v(F){return h.parseHTML(F,document,true)}function x(I,K,G){var J={},M=/<html/i.test(I);J.url=D(K.getResponseHeader("X-PJAX-URL")||G.requestUrl);if(M){var F=h(v(I.match(/<head[^>]*>([\s\S.]*)<\/head>/i)[0]));var H=h(v(I.match(/<body[^>]*>([\s\S.]*)<\/body>/i)[0]))}else{var F=H=h(v(I))}if(H.length===0){return J}J.title=o(F,"title").last().text();if(G.fragment){if(G.fragment==="body"){var L=H}else{var L=o(H,G.fragment).first()}if(L.length){J.contents=G.fragment==="body"?L:L.contents();if(!J.title){J.title=L.attr("title")||L.data("title")}}}else{if(!M){J.contents=H}}if(J.contents){J.contents=J.contents.not(function(){return h(this).is("title")});J.contents.find("title").remove();J.scripts=o(J.contents,"script[src]").remove();J.contents=J.contents.not(J.scripts)}if(J.title){J.title=h.trim(J.title)}return J}function a(F){if(!F){return}var G=h("script[src]");F.each(function(){var J=this.src;var K=G.filter(function(){return this.src===J});if(K.length){return}var H=document.createElement("script");var I=h(this).attr("type");if(I){H.type=I}H.src=h(this).attr("src");document.head.appendChild(H)})}var f={};var g=[];var i=[];function k(G,F){f[G]=F;i.push(G);b(g,0);b(i,B.defaults.maxCacheLength)}function u(H,J,G){var I,F;f[J]=G;if(H==="forward"){I=i;F=g}else{I=g;F=i}I.push(J);if(J=F.pop()){delete f[J]}b(I,B.defaults.maxCacheLength)}function b(F,G){while(F.length>G){delete f[F.shift()]}}function A(){return h("meta").filter(function(){var F=h(this).attr("http-equiv");return F&&F.toUpperCase()==="X-PJAX-VERSION"}).attr("content")}function p(){h.fn.pjax=l;h.pjax=B;h.pjax.enable=h.noop;h.pjax.disable=d;h.pjax.click=m;h.pjax.submit=r;h.pjax.reload=w;h.pjax.defaults={timeout:650,push:true,replace:false,type:"GET",dataType:"html",scrollTo:0,maxCacheLength:20,version:A};h(window).on("popstate.pjax",c)}function d(){h.fn.pjax=function(){return this};h.pjax=e;h.pjax.enable=p;h.pjax.disable=h.noop;h.pjax.click=h.noop;h.pjax.submit=h.noop;h.pjax.reload=function(){window.location.reload()};h(window).off("popstate.pjax",c)}if(h.inArray("state",h.event.props)<0){h.event.props.push("state")}h.support.pjax=window.history&&window.history.pushState&&window.history.replaceState&&!navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]\D|WebApps\/.+CFNetwork)/);h.support.pjax?p():d()})(jQuery);